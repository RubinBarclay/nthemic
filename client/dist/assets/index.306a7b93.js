var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,c=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&n(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&n(e,a,t[a]);return e},o=(e,r)=>t(e,a(r));import{R as i,r as m,t as u,c as p,P as d,u as y,C as x,N as b,H as h,S as f,a as g,B as E,L as v,b as N,d as w,F as k,V as S,e as C,f as I,g as T,h as P,i as L}from"./vendor.f7e7e2c3.js";const O=()=>i.createElement("div",{className:"flex items-center justify-center h-screen font-sans text-gray-200 bg-gray-900"},i.createElement("a",{href:"https://accounts.spotify.com/authorize?client_id=11c9d0da629948fb87a800307b571162&response_type=code&redirect_uri=https://nthemic.herokuapp.com/&scope=streaming%20user-read-email%20user-read-private%20user-top-read%20user-library-read%20user-library-modify%20user-read-playback-state%20user-modify-playback-state",className:"px-8 py-4 text-xl bg-purple-500 border-none rounded-full"},"Login with Spotify")),D=m.exports.createContext(),M=({playlist:e,play:t})=>i.createElement("div",{className:"relative flex items-center overflow-hidden h-1/2"},i.createElement("img",{className:"absolute z-0 w-full pointer-events-none filter blur brightness-85",src:e.albumCoverLG,alt:"background image"}),i.createElement("img",{className:"z-10 ml-40 mr-8 bg-red-200 shadow-xl w-72 h-72",src:e.albumCoverLG,alt:"playlist cover"}),i.createElement("div",{className:"z-10 text-white"},i.createElement("h3",{className:"w-2/3 my-2 text-4xl"},e.description.replace(/Cover:.*$/,"")),i.createElement("button",{onClick:()=>t(e),className:"px-6 py-3 my-2 text-xl bg-transparent border-2 border-white rounded-full transform transition duration-150 hover:scale-105",className:"px-6 py-3 text-xl bg-transparent border-2 border-gray-200 rounded-full hover:bg-gray-200 hover:text-gray-800 transition-colors whitespace-nowrap"},"Listen now"))),_=1/60*1e3,j=({title:e,items:t,play:a})=>{const r=m.exports.useRef(),{isDragging:l}=(e=>{const[t,a]=m.exports.useState(),[r,l]=m.exports.useState(),[s,n]=m.exports.useState(!1),[c,o]=m.exports.useState(0),[i,p]=m.exports.useState(0),[d,y]=m.exports.useState(0),[x,b]=m.exports.useState(0),h=e.current,f=m.exports.useCallback(u((e=>{y(e)}),_),[]),g=m.exports.useCallback(u((t=>{p(t),e.current.scrollLeft=e.current.scrollLeft+t*_*c}),_),[h,c]);return m.exports.useEffect((()=>{0!==c&&(i>.1&&!s?g(-.4+i):s?p(x):o(0))}),[i,s,x,c,g]),m.exports.useEffect((()=>{if(e.current){const c=t=>{a(t.screenX),l(e.current.scrollLeft),o(0)},i=a=>{if(a.preventDefault(),a.stopPropagation(),void 0!==t&&void 0!==r){const l=t-a.screenX;e.current.scrollLeft=r+l,Math.abs(l)>1&&(n(!0),o(l/Math.abs(l)),b(Math.abs((d-a.screenX)/_)),f(a.screenX))}},m=()=>{s&&void 0!==t&&(a(void 0),l(void 0),n(!1))};void 0===e.current.ontouchstart&&(e.current.onmousedown=c,e.current.onmousemove=i,e.current.onmouseup=m,e.current.onmouseleave=m)}}),[h,t,s,r,f,d]),{clickStartX:t,scrollStartX:r,isDragging:s,direction:c,momentum:i,lastScrollX:d,speed:x}})(r);return i.createElement("div",{className:"relative w-full p-4 overflow-hidden cursor-pointer"},i.createElement("h4",{className:"py-2 text-2xl"},e),i.createElement("div",{className:"w-full h-full overflow-x-scroll overflow-y-hidden scrollbar-hide",ref:r},i.createElement("div",{className:"inline-flex h-full",role:"list",style:{pointerEvents:l?"none":void 0}},t.map((e=>i.createElement("img",{src:e.albumCoverLG,alt:e.name,onClick:()=>a(e,null==e?void 0:e.index),key:(null==e?void 0:e.id)?e.id:e.collectionID,className:"flex-shrink-0 w-48 h-48 mr-4",role:"listitem"}))))))},R=({play:e})=>{const t=m.exports.useContext(D),[a,r]=m.exports.useState([]),[l,s]=m.exports.useState([]),[n,c]=m.exports.useState(),[o,u]=m.exports.useState([]),d=new p({clientId:"11c9d0da629948fb87a800307b571162"});return m.exports.useEffect((()=>{t&&(d.setAccessToken(t),d.getMyTopTracks({limit:10}).then((e=>{r(e.body.items.map((e=>({id:e.id,uri:e.uri,name:e.name,type:e.type,album:e.album.name,collectionID:e.album.id,artist:e.artists[0].name,index:e.track_number-1,albumCoverLG:e.album.images[1].url,albumCoverSM:e.album.images[2].url,duration:e.duration_ms}))))})).catch((e=>console.log(e))),d.getNewReleases({limit:10}).then((e=>{s(e.body.albums.items.map((e=>({type:e.type,album:e.name,collectionID:e.id,artist:e.artists[0].name,albumCoverLG:e.images[1].url,albumCoverSM:e.images[2].url}))))})).catch((e=>console.log(e))),d.getFeaturedPlaylists({limit:11}).then((e=>{const t=e.body.playlists.items.map((e=>({type:e.type,name:e.name,collectionID:e.id,description:e.description,albumCoverLG:e.images[0].url})));c(t[0]),u(t.slice(1))})).catch((e=>console.log(e))))}),[t]),n?i.createElement("div",{className:"w-full h-full"},i.createElement(M,{playlist:n,play:e}),i.createElement("div",{className:"p-4"},i.createElement(j,{title:"Your Top Tracks",items:a,play:e}),i.createElement(j,{title:"New music",items:l,play:e}),i.createElement(j,{title:"Featured Playlists",items:o,play:e}))):null},G=({setSearch:e})=>i.createElement("div",{className:"flex items-end justify-center h-1/4"},i.createElement("input",{type:"text",placeholder:"Search",onChange:t=>e(t.target.value),className:"w-1/3 px-2 text-2xl bg-transparent border-b-2 border-purple-500 outline-none focus:border-purple-600"})),A=e=>{var t=Math.floor(e/6e4),a=(e%6e4/1e3).toFixed(0);return t+":"+(a<10?"0":"")+a},$=({play:e,track:t})=>{const[a,r]=m.exports.useState(!1);return i.createElement("div",{className:"flex items-center my-2 cursor-pointer",onMouseOver:()=>r(!0),onMouseOut:()=>r(!1),onClick:()=>e(t,null==t?void 0:t.index)},i.createElement("div",{className:"relative"},i.createElement("img",{className:"w-20 h-auto bg-red-500",src:t.albumCoverSM,alt:t.name}),i.createElement("div",{className:`absolute inset-0 flex justify-center bg-black bg-opacity-50 opacity-${a?100:0} transition-opacity`},i.createElement(d,{className:"w-12 h-auto"}))),i.createElement("div",{className:"px-2 mb-2"},i.createElement("p",{className:"text-xl"},t.name),i.createElement("p",{className:"text-lg text-gray-400"},t.artist)),i.createElement("span",{className:"w-16 ml-auto text-lg text-center text-gray-200"},(()=>{switch(t.type){case"track":return A(t.duration);case"album":return t.albumType.charAt(0).toUpperCase()+t.albumType.slice(1);case"playlist":return"";default:throw"Unknown track type!"}})()))},X=({type:e,results:t,play:a})=>i.createElement("div",{className:"flex flex-col items-center p-8 pb-0"},i.createElement("div",{className:"w-3/5"},i.createElement("h2",{className:"text-2xl"},e),t.map((e=>i.createElement($,{key:e.id,play:a,track:e}))))),F=({play:e})=>{const t=m.exports.useContext(D),[a,r]=m.exports.useState(""),[l,s]=m.exports.useState(null),[n,c]=m.exports.useState(null),[o,u]=m.exports.useState(null),d=new p({clientId:"11c9d0da629948fb87a800307b571162"});return m.exports.useEffect((()=>{if(!a)return s(null),c(null),void u(null);if(!t)return;let e=!1;return d.setAccessToken(t),d.searchTracks(a,{limit:6}).then((t=>{e||s(t.body.tracks.items.map((e=>({id:e.id,uri:e.uri,name:e.name,type:e.type,collectionID:e.album.id,artist:e.artists[0].name,index:e.track_number-1,albumCoverLG:e.album.images[2].url,albumCoverSM:e.album.images[2].url,duration:e.duration_ms}))))})),d.searchAlbums(a,{limit:6}).then((t=>{e||c(t.body.albums.items.map((e=>({id:e.id,uri:e.uri,type:e.type,name:e.name,artist:e.artists[0].name,collectionID:e.id,albumCoverSM:e.images[2].url,albumType:e.album_type}))))})),d.searchPlaylists(a,{limit:6}).then((t=>{e||u(t.body.playlists.items.map((e=>({id:e.id,uri:e.uri,type:e.type,name:e.name,collectionID:e.id,albumCoverSM:e.images[0].url}))))})),()=>e=!0}),[a,t]),i.createElement("div",{className:"w-full h-full"},i.createElement(G,{setSearch:r}),l?i.createElement(X,{type:"Songs",results:l,play:e}):null,n?i.createElement(X,{type:"Albums",results:n,play:e}):null,o?i.createElement(X,{type:"Playlists",results:o,play:e}):null)};const U=()=>i.createElement("div",{className:"flex flex-col items-center justify-center w-full h-full"},i.createElement("img",{src:"/assets/under-construction.def95898.png",alt:"under construction",className:"h-auto w-80 opacity-85 filter invert"}),i.createElement("h2",{className:"m-4 text-5xl"},"Under Construction")),z=({play:e})=>{const{id:t,type:a}=y(),[r,l]=m.exports.useState(),[s,n]=m.exports.useState(!1),c=m.exports.useContext(D),o=new p({clientId:"11c9d0da629948fb87a800307b571162"});return m.exports.useEffect((()=>{c&&(o.setAccessToken(c),"album"===a||"track"===a?o.getAlbum(t).then((e=>{l({type:a,collectionID:t,name:e.body.name,author:e.body.artists[0].name,albumCoverLG:e.body.images[1].url,tracks:e.body.tracks.items.map((r=>({type:a,collectionID:t,id:r.id,uri:r.uri,name:r.name,album:e.body.name,artist:r.artists[0].name,duration:r.duration_ms,albumCoverLG:e.body.images[1].url,albumCoverSM:e.body.images[2].url})))})})):"playlist"===a&&o.getPlaylist(t).then((e=>{l({type:a,collectionID:t,name:e.body.name,author:e.body.owner.display_name,albumCoverLG:e.body.images[0].url,tracks:e.body.tracks.items.slice(0,20).map((e=>({type:a,collectionID:t,id:e.track.id,uri:e.track.uri,name:e.track.name,album:e.track.album.name,artist:e.track.artists[0].name,duration:e.track.duration_ms,albumCoverLG:e.track.album.images[1].url,albumCoverSM:e.track.album.images[2].url})))})})))}),[c]),r?i.createElement("div",{className:"w-full h-full px-48 pt-32"},i.createElement("div",{className:"border-2 border-t-0 border-gray-800"},i.createElement("div",{className:"flex items-center h-auto bg-gray-800"},i.createElement("img",{className:"w-64 h-auto",src:r.albumCoverLG,alt:r.name}),i.createElement("div",{className:"pl-6"},i.createElement("h1",{className:"text-4xl"},r.name),i.createElement("h2",{className:"py-2 text-xl text-gray-400"},"By: ",r.author)),i.createElement("button",{className:"px-6 py-3 ml-auto mr-16 text-xl bg-transparent border-2 border-gray-200 rounded-full hover:bg-gray-200 hover:text-gray-900 transition-colors whitespace-nowrap",onClick:()=>e(r)},"Play now")),i.createElement("table",{className:"w-full mt-5 text-lg text-center"},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",{className:"w-8"},"#"),i.createElement("th",{className:"pl-2 text-left"},"Track"),i.createElement("th",{className:"w-16"},i.createElement(x,{className:"w-5 h-auto mx-auto"})))),i.createElement("tbody",null,r.tracks.map(((t,a)=>i.createElement("tr",{key:t.id,onClick:()=>e(t,a),onMouseOver:()=>n(a),onMouseOut:()=>n(null),className:"h-4 leading-8 hover:bg-gray-800"},i.createElement("td",null,s===a?i.createElement(d,{className:"w-5 h-auto mx-auto"}):a+1),i.createElement("td",{className:"pl-2 text-left"},t.name),i.createElement("td",null,A(t.duration)))))))),i.createElement("div",{className:"p-8"})):null},B=()=>i.createElement("div",{className:"py-2 bg-gray-800 col-span-2"},i.createElement("h1",{className:"p-6 text-3xl font-semibold text-center text-purple-500"},i.createElement("span",{className:"text-4xl text-purple-400"},"N"),"themic"),i.createElement("div",{className:"flex flex-col"},i.createElement(b,{exact:!0,to:"/",activeClassName:"bg-gray-700",className:"flex items-center p-4 px-8 text-xl transition-colors hover:text-purple-400"},i.createElement(h,{className:"w-6 h-6"}),i.createElement("span",{className:"pl-4"},"Home")),i.createElement(b,{to:"/search",activeClassName:"bg-gray-700",className:"flex items-center p-4 px-8 text-xl transition-colors hover:text-purple-400"},i.createElement(f,{className:"w-6 h-6"}),i.createElement("span",{className:"pl-4"},"Search")),i.createElement(b,{to:"/settings",activeClassName:"bg-gray-700",className:"flex items-center p-4 px-8 text-xl transition-colors hover:text-purple-400"},i.createElement(g,{className:"w-6 h-6"}),i.createElement("span",{className:"pl-4"},"Settings")))),J=({track:e,playing:t,progressState:a,setProgressState:r,nextTrack:l,player:s})=>{const[n,c]=m.exports.useState(!1);let o=m.exports.useRef("0%"),u=m.exports.useRef(new E(0)),p=m.exports.useRef(0);m.exports.useEffect((()=>{c(!0),r(o);const e=setInterval(d,500);return t?()=>clearInterval(e):clearInterval(e)}),[t]),m.exports.useEffect((()=>{o.current="0%",u.current=new E(0),p.current=e.duration,c(!1),r("0%")}),[e]);const d=()=>{!n&&c(!0);const e=u.current.plus(500).div(p.current).times(100).toString()+"%";u.current=u.current.plus(500),o.current=e,r(e),y()},y=()=>{u.current.gte(p.current)&&l()};return i.createElement("div",{className:"absolute top-0 left-0 right-0 flex bg-gray-700"},i.createElement("input",{type:"range",id:"progressSelector",min:"0",max:"200",className:"absolute inset-0 w-full opacity-0 cursor-pointer",onClick:e=>(e=>{const t=new E(e).div(2).toFixed(1),a=new E(p.current).times(new E(t).div(100));o.current=t+"%",u.current=a,c(!1),r(t+"%"),s.seek(a.toNumber()),y()})(e.target.value)}),i.createElement("div",{className:"bg-purple-500",style:{height:"0.2rem",width:a,transition:n?"all .5s linear":null}}))},V=({currentItem:{item:e,index:t}})=>{const a=m.exports.useContext(D),[r,l]=m.exports.useState(!1),[s,n]=m.exports.useState(),[u,y]=m.exports.useState([]),[x,b]=m.exports.useState(),[h,f]=m.exports.useState("0%"),[g,E]=m.exports.useState(25),[I,T]=m.exports.useState(!1),[P,L]=m.exports.useState(!1);let O=m.exports.useRef(),M=m.exports.useRef(0);const _=new p({clientId:"11c9d0da629948fb87a800307b571162"});m.exports.useEffect((()=>{if(a&&window.Spotify)return O.current=new window.Spotify.Player({name:"Nthemic Music Player",getOAuthToken:e=>{e(a)},volume:.25}),O.current.connect().then((e=>{e?console.log("The Web Playback SDK successfully connected to Spotify!"):console.log("[ERROR] The Web Playback SDK failed to connect to Spotify")})),O.current.addListener("ready",(({device_id:e})=>{b(e)})),()=>O.current.disconnect()}),[a]),m.exports.useEffect((()=>{if(e&&a)switch(_.setAccessToken(a),e.type){case"track":case"album":_.getAlbumTracks(e.collectionID,{limit:20}).then((a=>{const r=t=>o(c({},e),{id:t.id,uri:t.uri,name:t.name,duration:t.duration_ms});n(r(a.body.items[t])),y(a.body.items.map(r))})).catch((e=>console.log(e)));break;case"playlist":_.getPlaylistTracks(e.collectionID,{limit:20}).then((a=>{const r=t=>o(c({},e),{id:t.track.id,uri:t.track.uri,name:t.track.name,album:t.track.album.name,artist:t.track.artists[0].name,duration:t.track.duration_ms,albumCoverLG:t.track.album.images[1].url,albumCoverSM:t.track.album.images[2].url});n(r(a.body.items[t])),y(a.body.items.map(r))})).catch((e=>console.log(e)));break;default:console.log("[ERROR] Unknown item type"),console.log("item.type: ",e.type)}}),[e]),m.exports.useEffect((()=>{s&&O.current&&(M.current=t,j({spotify_uri:s.uri,playerInstance:O.current}),L(!0))}),[u]);const j=({spotify_uri:e,playerInstance:{_options:{getOAuthToken:t}}})=>{l(!0),t((t=>{fetch(`https://api.spotify.com/v1/me/player/play?device_id=${x}`,{method:"PUT",body:JSON.stringify({uris:[e]}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})}))},R=()=>{const e=M.current+1;M.current=M.current+1,e<u.length?(j({spotify_uri:u[e].uri,playerInstance:O.current}),n(u[e])):(O.current.pause(),l(!1),f("100%"))};return P?i.createElement("div",{className:"relative flex items-center justify-center w-screen h-20 bg-gray-900"},i.createElement(J,{track:s,trackList:u,playing:r,setPlaying:l,progressState:h,setProgressState:f,nextTrack:R,player:O.current}),i.createElement(v,{to:`/collection/${s.type}/${s.collectionID}`},i.createElement("img",{className:"w-16 cursor-pointer h-14",src:null==s?void 0:s.albumCoverSM,alt:null==s?void 0:s.name})),i.createElement("div",{className:"px-5 text-center"},i.createElement(v,{className:"hover:underline",to:`/collection/${s.type}/${s.collectionID}`},s.name),i.createElement("p",{className:"text-sm text-gray-400"},s.artist)),i.createElement(N,{className:"w-8 h-8",onClick:()=>{const e=M.current-1;M.current=M.current-1,e>=0?(j({spotify_uri:u[e].uri,playerInstance:O.current}),n(u[e])):(j({spotify_uri:u[0].uri,playerInstance:O.current}),n(u[0]))}}),i.createElement("div",{onClick:()=>{O.current.togglePlay().then((()=>{l((e=>!e))}))}},r?i.createElement(w,{className:"w-10 h-10"}):i.createElement(d,{className:"w-10 h-10"})),i.createElement(k,{className:"w-8 h-8",onClick:R}),i.createElement("div",{className:"relative m-4",onWheel:e=>{E((t=>{let a=e.deltaY<0?t+5:t-5;return a=a>100?100:a<0?0:a,O.current.setVolume(a/100),a}))},onClick:()=>{O.current.setVolume(I?g/100:0),T((e=>!e))}},I?i.createElement(S,{className:"w-6 h-6"}):i.createElement(m.exports.Fragment,null,i.createElement(C,{className:"w-6 h-6"}),i.createElement("span",{className:"absolute text-gray-400 left-full top-1/2 transform translate-x-2 -translate-y-1/2"},g,"%")))):null},W=({code:e})=>{const t=(e=>{const[t,a]=m.exports.useState(),[r,l]=m.exports.useState(),[s,n]=m.exports.useState();return m.exports.useEffect((()=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})};fetch("https://nthemic.herokuapp.com/login",t).then((e=>e.json())).then((e=>{a(e.accessToken),l(e.refreshToken),n(e.expiresIn),window.history.pushState({},null,"/")})).catch((()=>{window.location="/"}))}),[e]),m.exports.useEffect((()=>{if(!r||!s)return;const e=setInterval((()=>{const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})};fetch("https://nthemic.herokuapp.com/refresh",e).then((e=>e.json())).then((e=>{a(e.accessToken),n(e.expiresIn)})).catch((()=>{window.location="/"}))}),1e3*(s-60));return()=>clearInterval(e)}),[r,s]),t})(e),[a,r]=m.exports.useState({item:null,index:null}),l=(e,t=0)=>{r({item:e,index:t})};return t?i.createElement(I,null,i.createElement(D.Provider,{value:t},i.createElement("div",{className:"h-screen font-sans text-gray-200 bg-gray-900 grid-rows-custom grid grid-cols-10"},i.createElement(B,null),i.createElement("div",{className:"overflow-y-scroll scrollbar-hide col-span-8 grid-cols-12"},i.createElement(T,null,i.createElement(P,{exact:!0,path:"/",render:()=>i.createElement(R,{play:l})}),i.createElement(P,{path:"/search",render:()=>i.createElement(F,{play:l})}),i.createElement(P,{path:"/settings",component:U}),i.createElement(P,{path:"/collection/:type/:id",component:()=>i.createElement(z,{play:l})}))),i.createElement(V,{currentItem:a})))):null},H=()=>{const[e,t]=m.exports.useState();return m.exports.useEffect((()=>{t(new URLSearchParams(window.location.search).get("code"))}),[]),e?i.createElement(W,{code:e}):i.createElement(O,null)};L.render(i.createElement(i.StrictMode,null,i.createElement(H,null)),document.getElementById("root"));
